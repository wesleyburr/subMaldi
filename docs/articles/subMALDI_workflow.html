<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>subMALDI: Sample Workflow • subMALDI</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="subMALDI: Sample Workflow">
<meta property="og:description" content="subMALDI">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">subMALDI</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0-1-rc</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/subMALDI_workflow.html">subMALDI: Sample Workflow</a>
    </li>
    <li>
      <a href="../articles/subMALDIprocessing.html">Processing with subMALDI</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="subMALDI_workflow_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>subMALDI: Sample Workflow</h1>
                        <h4 data-toc-skip class="author">Kristen Yeh<sup>1</sup>, Sophie Castel<sup>2</sup> and Wesley Burr <sup>3</sup>
</h4>
            
      
      
      <div class="hidden name"><code>subMALDI_workflow.Rmd</code></div>

    </div>

    
    
<p><sup>1</sup> Forensic Science Program, Trent University, Peterborough, ON, Canada</p>
<p><sup>2</sup> Faculty of Science, Applied Bioscience, Ontario Tech University, Oshawa, ON, Canada</p>
<p><sup>3</sup> Faculty of Science, Mathematics, Trent University, Peterborough, ON, Canada</p>
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>In this vignette we demonstrate a processing workflow for irregularly-spaced mass spectrometry data using <strong><em>subMALDI</em></strong>. This package is freely available from <a href="https://github.com/wesleyburr/subMaldi" class="external-link">GitHub</a> and was created using MALDI FT-ICR mass spectrometry data.</p>
<hr>
</div>
<div id="installation-and-import" class="section level1">
<h1 class="hasAnchor">
<a href="#installation-and-import" class="anchor"></a>Installation and Import</h1>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>To download the package, select the ‘.tar.gz’ file from the git repository. This file can then used to install the package in R. Below, we load the package and its dependencies.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">subMALDI</span><span class="op">)</span>
<span class="co">#&gt; Loading required package: dplyr</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'dplyr'</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter, lag</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span>
<span class="co">#&gt; Loading required package: tidyr</span>
<span class="co">#&gt; Loading required package: ggplot2</span>
<span class="co">#&gt; Loading required package: ggpmisc</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'ggpmisc'</span>
<span class="co">#&gt; The following object is masked from 'package:ggplot2':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     annotate</span>
<span class="co">#&gt; Loading required package: reshape2</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'reshape2'</span>
<span class="co">#&gt; The following object is masked from 'package:tidyr':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     smiths</span>
<span class="co">#&gt; Loading required package: RColorBrewer</span>
<span class="co">#&gt; Warning: replacing previous import 'ggplot2::annotate' by 'ggpmisc::annotate'</span>
<span class="co">#&gt; when loading 'subMALDI'</span>
<span class="co">#&gt; Warning: replacing previous import 'dplyr::filter' by 'signal::filter' when</span>
<span class="co">#&gt; loading 'subMALDI'</span></code></pre></div>
</div>
<div id="import" class="section level2">
<h2 class="hasAnchor">
<a href="#import" class="anchor"></a>Import</h2>
<p>Two import functions are included in the package. Both read .CSV files which contain spectral data from a single spectrum per file. While <code><a href="../reference/readcsvSpec.html">readcsvSpec()</a></code> imports one spectrum at a time and turns them into a pairwise data frame of <em>m/z</em> and intensity data, <code><a href="../reference/readcsvDir.html">readcsvDir()</a></code> is capable of reading all the .CSV files in a folder. The pairwise data frames generated for all of these spectra are then output as .rda files into a designated output folder.</p>
<p>For example, let’s say we have a set of 5 spectral replicates in our working directory. These are stored as .CSV files in a folder called “my_spec”. In the original file, mass data is stored in a column called “m.z”, while intensity data is stored in a column called “I”. If we wanted to import only one of the spectra, specifically “Sample1.csv”, then we would run the following code.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">my_spec1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/readcsvSpec.html">readcsvSpec</a></span><span class="op">(</span>spec_file <span class="op">=</span> <span class="st">"~/my_spec/Sample1.csv"</span>, massCol <span class="op">=</span> <span class="st">"m.z"</span>, intenseCol <span class="op">=</span> <span class="st">"I"</span><span class="op">)</span></code></pre></div>
<p>Conversely, if we wanted to import all spectra in the folder “my_spec” into a new folder called “out”, we would run the following.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/readcsvDir.html">readcsvDir</a></span><span class="op">(</span>direct <span class="op">=</span> <span class="st">"~/my_spec/"</span>, massCol <span class="op">=</span> <span class="st">"m.z"</span>, intenseCol <span class="op">=</span> <span class="st">"I"</span>, output <span class="op">=</span> <span class="st">"~/my_spec/out/"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"~/my_spec/out/Sample1.rda"</span><span class="op">)</span></code></pre></div>
<p>This will create a pairwise data frame of <em>m/z</em> and intensity data, much like the one shown below.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"Blank1"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">Blank1</span><span class="op">)</span>
<span class="co">#&gt;          mass Intensity</span>
<span class="co">#&gt; m.z1 53.77809   1189673</span>
<span class="co">#&gt; m.z2 53.78582   1296961</span>
<span class="co">#&gt; m.z3 53.79091   1329388</span>
<span class="co">#&gt; m.z4 53.80821   1256587</span>
<span class="co">#&gt; m.z5 53.82150   1190686</span>
<span class="co">#&gt; m.z6 53.82591   1247174</span></code></pre></div>
<hr>
</div>
<div id="reading-in-an-ascii-file" class="section level2">
<h2 class="hasAnchor">
<a href="#reading-in-an-ascii-file" class="anchor"></a>Reading in an ASCII File</h2>
<p>The mass spectrometer may produce raw output data in  format. In this case, the  function can be used to read in the data file and convert it to a  object. Simply specify the filepath, as shown below:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># spec_data &lt;- read_ascii(filename = "~/filename.ascii")</span></code></pre></div>
<p>Once loaded into the global environment, the object can be saved to the local directory as a  file using the  function:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># write.csv(spec_data, file = "~/filename.csv")</span></code></pre></div>
</div>
</div>
<div id="creating-a-mapped-data-frame" class="section level1">
<h1 class="hasAnchor">
<a href="#creating-a-mapped-data-frame" class="anchor"></a>Creating a Mapped Data Frame</h1>
<p>In order to compare unevenly spaced spectral data, it is essential that the spectra be standardized by some means. When performing R analysis, replicates must be aligned against the same data structure, requiring that each spectrum has a consistent number of data points.</p>
<div id="create-an-empty-data-frame" class="section level2">
<h2 class="hasAnchor">
<a href="#create-an-empty-data-frame" class="anchor"></a>Create an Empty Data Frame</h2>
<p><strong><em>subMALDI</em></strong> permits the comparison of unevenly spaced mass spectrometry data by mapping each peak in a spectrum to all of the theoretically possible <em>m/z</em> values in the analyzed mass range.</p>
<p>First, an empty data frame containing all of the theoretically possible <em>m/z</em> values is created. As the sample data sets included with this package were acquired between the mass range of <em>m/z</em> 53.76 to 1100 with a resolution of four decimal places, the empty data frame we create will be customized for this data. This is performed using the following code.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">spec_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createSpecDF.html">createSpecDF</a></span><span class="op">(</span>min_mz <span class="op">=</span> <span class="fl">53.76</span>, max_mz <span class="op">=</span> <span class="fl">1100</span>, res <span class="op">=</span> <span class="fl">1e-04</span>, dig <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">spec_df</span><span class="op">)</span>
<span class="co">#&gt;   full_mz Sample</span>
<span class="co">#&gt; 1 53.7600      0</span>
<span class="co">#&gt; 2 53.7601      0</span>
<span class="co">#&gt; 3 53.7602      0</span>
<span class="co">#&gt; 4 53.7603      0</span>
<span class="co">#&gt; 5 53.7604      0</span>
<span class="co">#&gt; 6 53.7605      0</span></code></pre></div>
<p>We have created a long data frame containing <em>m/z</em> data in the first column. This data frame can now be manipulated with <code>dplyr</code>’s <code>select()</code> function to create columns specific to our spectral data.</p>
<p>We will add 4 columns of sample data, corresponding to 2 matrix blanks and 2 sample spectra.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">spec_df</span> <span class="op">&lt;-</span> <span class="fu">select</span><span class="op">(</span><span class="va">spec_df</span>, <span class="st">"full_mz"</span><span class="op">)</span>
<span class="va">spec_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/transform.html" class="external-link">transform</a></span><span class="op">(</span><span class="va">spec_df</span>, <span class="st">"Blank1"</span> <span class="op">=</span> <span class="fl">0</span>, <span class="st">"Blank2"</span> <span class="op">=</span> <span class="fl">0</span>, <span class="st">"Before1"</span> <span class="op">=</span> <span class="fl">0</span>, <span class="st">"Before2"</span> <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">spec_df</span><span class="op">)</span>
<span class="co">#&gt;   full_mz Blank1 Blank2 Before1 Before2</span>
<span class="co">#&gt; 1 53.7600      0      0       0       0</span>
<span class="co">#&gt; 2 53.7601      0      0       0       0</span>
<span class="co">#&gt; 3 53.7602      0      0       0       0</span>
<span class="co">#&gt; 4 53.7603      0      0       0       0</span>
<span class="co">#&gt; 5 53.7604      0      0       0       0</span>
<span class="co">#&gt; 6 53.7605      0      0       0       0</span></code></pre></div>
<p>Once the data frame is customized for our sample data, each spectrum can now be mapped to its respective column.</p>
</div>
<div id="map-spectral-data-to-empty-data-frame" class="section level2">
<h2 class="hasAnchor">
<a href="#map-spectral-data-to-empty-data-frame" class="anchor"></a>Map Spectral Data to Empty Data Frame</h2>
<p>Before any spectra are mapped to our data frame, the spectral data must be loaded. The pairwise spectra included with the package are loaded below.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"Blank1"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"Blank2"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"Before1"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"Before2"</span><span class="op">)</span></code></pre></div>
<p>Now that the pairwise spectra have been loaded, we can map them to our empty data frame. It is important to note that the <code>thresh</code> and <code>dig</code> values must match the <code>res</code> and <code>dig</code> values used in <code><a href="../reference/createSpecDF.html">createSpecDF()</a></code>, otherwise data will fail to map.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">spec_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mapSpectrum.html">mapSpectrum</a></span><span class="op">(</span>dat <span class="op">=</span> <span class="va">Blank1</span>, massCol <span class="op">=</span> <span class="st">"mass"</span>, intenseCol <span class="op">=</span> <span class="st">"Intensity"</span>, 
            spec_df <span class="op">=</span> <span class="va">spec_df</span>, colName <span class="op">=</span> <span class="st">"Blank1"</span>, thresh <span class="op">=</span> <span class="fl">1e-04</span>, dig <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>
<span class="va">spec_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mapSpectrum.html">mapSpectrum</a></span><span class="op">(</span>dat <span class="op">=</span> <span class="va">Blank2</span>, massCol <span class="op">=</span> <span class="st">"mass"</span>, intenseCol <span class="op">=</span> <span class="st">"Intensity"</span>, 
            spec_df <span class="op">=</span> <span class="va">spec_df</span>, colName <span class="op">=</span> <span class="st">"Blank2"</span>, thresh <span class="op">=</span> <span class="fl">1e-04</span>, dig <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>
<span class="va">spec_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mapSpectrum.html">mapSpectrum</a></span><span class="op">(</span>dat <span class="op">=</span> <span class="va">Before1</span>, massCol <span class="op">=</span> <span class="st">"mass"</span>, intenseCol <span class="op">=</span> <span class="st">"Intensity"</span>, 
            spec_df <span class="op">=</span> <span class="va">spec_df</span>, colName <span class="op">=</span> <span class="st">"Before1"</span>, thresh <span class="op">=</span> <span class="fl">1e-04</span>, dig <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>
<span class="va">spec_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mapSpectrum.html">mapSpectrum</a></span><span class="op">(</span>dat <span class="op">=</span> <span class="va">Before2</span>, massCol <span class="op">=</span> <span class="st">"mass"</span>, intenseCol <span class="op">=</span> <span class="st">"Intensity"</span>, 
            spec_df <span class="op">=</span> <span class="va">spec_df</span>, colName <span class="op">=</span> <span class="st">"Before2"</span>, thresh <span class="op">=</span> <span class="fl">1e-04</span>, dig <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">spec_df</span><span class="op">)</span>
<span class="co">#&gt;   full_mz Blank1  Blank2 Before1 Before2</span>
<span class="co">#&gt; 1 53.7600      0       0       0       0</span>
<span class="co">#&gt; 2 53.7601      0       0       0       0</span>
<span class="co">#&gt; 3 53.7602      0       0       0       0</span>
<span class="co">#&gt; 4 53.7603      0       0       0       0</span>
<span class="co">#&gt; 5 53.7604      0       0       0       0</span>
<span class="co">#&gt; 6 53.7605      0 1121123  669511       0</span></code></pre></div>
</div>
<div id="remove-empty-rows" class="section level2">
<h2 class="hasAnchor">
<a href="#remove-empty-rows" class="anchor"></a>Remove Empty Rows</h2>
<p>From the output above, we can see there are several rows which contain only zero intensity values. The data frame is 10462401 rows long, and should be reduced in size to minimize the computational load of further processing functions.</p>
<p>It is important to note that <em>ALL</em> samples or spectral replicates to be compared must be mapped to the data frame prior to removal of empty rows, as new samples cannot be mapped after the original mapping <em>m/z</em> vector has been truncated.</p>
<p>Empty rows are removed from our mapped spectral data frame below.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rmveEmpty.html">rmveEmpty</a></span><span class="op">(</span><span class="va">spec_df</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">spec</span><span class="op">)</span>
<span class="co">#&gt;    full_mz Blank1  Blank2 Before1 Before2</span>
<span class="co">#&gt; 6  53.7605      0 1121123  669511       0</span>
<span class="co">#&gt; 7  53.7606      0  926236       0       0</span>
<span class="co">#&gt; 8  53.7607      0       0  846871       0</span>
<span class="co">#&gt; 9  53.7608      0  683309  692057       0</span>
<span class="co">#&gt; 10 53.7609      0  613175  793328       0</span>
<span class="co">#&gt; 11 53.7610      0       0  834638  695440</span>
<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">spec</span><span class="op">)</span>
<span class="co">#&gt; [1] 820893</span></code></pre></div>
<p>The number of rows has been reduced by 9641508. We can now proceed with further processing.</p>
<hr>
</div>
</div>
<div id="manipulate-raw-data" class="section level1">
<h1 class="hasAnchor">
<a href="#manipulate-raw-data" class="anchor"></a>Manipulate Raw Data</h1>
<p>In our spectral data frame we have three sets of spectral replicates: 2 matrix blanks, 2 sample spectra acquired prior to chemical intervention, and 2 sample spectra acquired after chemical intervention.</p>
<p>To distinguish between peaks originating from the matrix and peaks originating from the sample, we will average our matrix blank spectra, and then subtract the average blank spectrum from each sample.</p>
<div id="average-intensity-data" class="section level2">
<h2 class="hasAnchor">
<a href="#average-intensity-data" class="anchor"></a>Average Intensity Data</h2>
<p>There are two methods available for averaging our intensity data: sum or mean. In this example we will use the method “mean” on the matrix blanks “Blank1” and “Blank2”. This is performed using the code below.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">avg_spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/avgSpectra.html">avgSpectra</a></span><span class="op">(</span><span class="va">spec</span>, method <span class="op">=</span> <span class="st">"mean"</span>, spectra_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Blank1"</span>, <span class="st">"Blank2"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">avg_spec</span><span class="op">)</span>
<span class="co">#&gt;         mz full_mz Blank1  Blank2 Before1 Before2  Average</span>
<span class="co">#&gt; 6  53.7605 53.7605      0 1121123  669511       0 560561.5</span>
<span class="co">#&gt; 7  53.7606 53.7606      0  926236       0       0 463118.0</span>
<span class="co">#&gt; 8  53.7607 53.7607      0       0  846871       0      0.0</span>
<span class="co">#&gt; 9  53.7608 53.7608      0  683309  692057       0 341654.5</span>
<span class="co">#&gt; 10 53.7609 53.7609      0  613175  793328       0 306587.5</span>
<span class="co">#&gt; 11 53.7610 53.7610      0       0  834638  695440      0.0</span></code></pre></div>
<p>A new column has now been added to our original data frame, containing the averaged blank intensity data. Now that the data has been averaged, we can subtract our blank spectrum from each sample.</p>
</div>
<div id="subtract-intensity-data" class="section level2">
<h2 class="hasAnchor">
<a href="#subtract-intensity-data" class="anchor"></a>Subtract Intensity Data</h2>
<p>We will subtract our averaged matrix blank from samples “Before1” and “Before2” below. First, we will restructure our data frame to remove the matrix blank columns, whose intensity data is now contained in the “Average” column. Next, we will add new columns to the data frame for the new subtracted intensity data.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu">select</span><span class="op">(</span><span class="va">avg_spec</span>, <span class="st">"full_mz"</span>, <span class="st">"Before1"</span>, <span class="st">"Before2"</span>, <span class="st">"Average"</span><span class="op">)</span>
<span class="va">sub_spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/transform.html" class="external-link">transform</a></span><span class="op">(</span><span class="va">spec</span>, <span class="st">"Sub_Before1"</span> <span class="op">=</span> <span class="fl">0</span>, <span class="st">"Sub_Before2"</span> <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></code></pre></div>
<p>Finally, we will subtract our averaged matrix blank from each sample spectrum.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sub_spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subSpectra.html">subSpectra</a></span><span class="op">(</span>dat <span class="op">=</span> <span class="va">sub_spec</span>, Blank_Var <span class="op">=</span> <span class="st">"Average"</span>, 
                       Sample <span class="op">=</span> <span class="st">"Before1"</span>, Sub_Sample <span class="op">=</span> <span class="st">"Sub_Before1"</span><span class="op">)</span>
<span class="va">sub_spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subSpectra.html">subSpectra</a></span><span class="op">(</span>dat <span class="op">=</span> <span class="va">sub_spec</span>, Blank_Var <span class="op">=</span> <span class="st">"Average"</span>, 
                       Sample <span class="op">=</span> <span class="st">"Before2"</span>, Sub_Sample <span class="op">=</span> <span class="st">"Sub_Before2"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sub_spec</span><span class="op">)</span>
<span class="co">#&gt;    full_mz Before1 Before2  Average Sub_Before1 Sub_Before2</span>
<span class="co">#&gt; 6  53.7605  669511       0 560561.5    108949.5           0</span>
<span class="co">#&gt; 7  53.7606       0       0 463118.0         0.0           0</span>
<span class="co">#&gt; 8  53.7607  846871       0      0.0    846871.0           0</span>
<span class="co">#&gt; 9  53.7608  692057       0 341654.5    350402.5           0</span>
<span class="co">#&gt; 10 53.7609  793328       0 306587.5    486740.5           0</span>
<span class="co">#&gt; 11 53.7610  834638  695440      0.0    834638.0      695440</span></code></pre></div>
<hr>
</div>
</div>
<div id="normalization-methods" class="section level1">
<h1 class="hasAnchor">
<a href="#normalization-methods" class="anchor"></a>Normalization Methods</h1>
<p>In addition to simple subtraction and averaging functions, <strong><em>subMALDI</em></strong> also offers several normalization methods. These are listed below:</p>
<ol style="list-style-type: decimal">
<li>Custom <em>m/z</em>
</li>
<li>Maximum Intensity</li>
<li>Root Mean Square (RMS)</li>
<li>Total Ion Current (TIC)</li>
<li>Median</li>
<li>Standard Deviation of Noise</li>
<li>Quantile</li>
</ol>
<p>A sample normalization for each method will be shown in order, below. We will begin by loading a smaller sample data set to work with.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"Master2"</span><span class="op">)</span>
<span class="va">norm_spec</span> <span class="op">&lt;-</span> <span class="fu">select</span><span class="op">(</span><span class="va">Master2</span>, <span class="st">"full_mz"</span>, <span class="st">"Before1"</span>, <span class="st">"Before2"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">norm_spec</span><span class="op">)</span>
<span class="co">#&gt;   full_mz  Before1  Before2</span>
<span class="co">#&gt; 1   53.76 639658.9  85377.6</span>
<span class="co">#&gt; 2   53.77 590149.7 201271.6</span>
<span class="co">#&gt; 3   53.78 842546.9 336924.7</span>
<span class="co">#&gt; 4   53.79 645083.7 382732.5</span>
<span class="co">#&gt; 5   53.80 424006.9 409202.8</span>
<span class="co">#&gt; 6   53.81 401261.6 319758.4</span></code></pre></div>
<p>The raw data is plotted below.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plotSpectra.html">plotSpectra</a></span><span class="op">(</span><span class="va">norm_spec</span>, mass_dat <span class="op">=</span> <span class="st">"full_mz"</span>, spectra_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Before1"</span>, <span class="st">"Before2"</span><span class="op">)</span>, x_ticks <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></code></pre></div>
<p><img src="subMALDI_workflow_files/figure-html/unnamed-chunk-16-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Please note that while only two spectra are normalized in this vignette, <strong><em>subMALDI</em></strong> is capable of normalizing several spectral replicates at once, the resulting plots of which can be arranged using the <strong><em>nrows</em></strong> argument.</p>
<div id="custom-mz-normalization" class="section level2">
<h2 class="hasAnchor">
<a href="#custom-mz-normalization" class="anchor"></a>Custom <em>m/z</em> Normalization</h2>
<p>Custom <em>m/z</em> normalization is one of the simpler methods included with <strong><em>subMALDI</em></strong>. This method allows the user to select a specific <em>m/z</em> peak and normalizes the intensity of the spectrum to the intensity of the selected peak. In other words, the maximum intensity in the spectrum is set to the intensity of the selected peak.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">custom_ex</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/normSpectra.html">normSpectra</a></span><span class="op">(</span><span class="va">norm_spec</span>, mass_dat <span class="op">=</span> <span class="st">"full_mz"</span>, method <span class="op">=</span> <span class="st">"custom"</span>, 
                         norm_mz <span class="op">=</span> <span class="fl">255.23</span>, spectra_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Before1"</span>, <span class="st">"Before2"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="../reference/plotSpectra.html">plotSpectra</a></span><span class="op">(</span><span class="va">norm_spec</span>,mass_dat <span class="op">=</span> <span class="st">"full_mz"</span>, spectra_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Before1"</span>, <span class="st">"Before2"</span><span class="op">)</span>, x_ticks <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="fu"><a href="../reference/plotSpectra.html">plotSpectra</a></span><span class="op">(</span><span class="va">custom_ex</span>, mass_dat <span class="op">=</span> <span class="st">"full_mz"</span>, spectra_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Before1"</span>, <span class="st">"Before2"</span><span class="op">)</span>, x_ticks <span class="op">=</span> <span class="fl">5</span>, palette <span class="op">=</span> <span class="st">"Accent"</span><span class="op">)</span></code></pre></div>
<p><img src="subMALDI_workflow_files/figure-html/unnamed-chunk-17-1.png" width="700"><img src="subMALDI_workflow_files/figure-html/unnamed-chunk-17-2.png" width="700"></p>
<p>The original spectra are shown to the right, while the normalized spectra are displayed on the left.</p>
</div>
<div id="maximum-intensity-normalization" class="section level2">
<h2 class="hasAnchor">
<a href="#maximum-intensity-normalization" class="anchor"></a>Maximum Intensity Normalization</h2>
<p>Maximum intensity normalization is another simple method included with <strong><em>subMALDI</em></strong>. This method takes the most intense peak in a spectrum and re-scales the intensity data from an exponential scale (ex. 0 to 1e11) to a scale of 0,1.</p>
<p>A sample normalization is performed below.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">max_ex</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/normSpectra.html">normSpectra</a></span><span class="op">(</span><span class="va">norm_spec</span>, mass_dat <span class="op">=</span> <span class="st">"full_mz"</span>, method <span class="op">=</span> <span class="st">"max"</span>, 
                      spectra_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Before1"</span>, <span class="st">"Before2"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="../reference/plotSpectra.html">plotSpectra</a></span><span class="op">(</span><span class="va">norm_spec</span>,mass_dat <span class="op">=</span> <span class="st">"full_mz"</span>, spectra_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Before1"</span>, <span class="st">"Before2"</span><span class="op">)</span>, x_ticks <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="fu"><a href="../reference/plotSpectra.html">plotSpectra</a></span><span class="op">(</span><span class="va">max_ex</span>, mass_dat <span class="op">=</span> <span class="st">"full_mz"</span>, spectra_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Before1"</span>, <span class="st">"Before2"</span><span class="op">)</span>, x_ticks <span class="op">=</span> <span class="fl">5</span>, palette <span class="op">=</span> <span class="st">"Accent"</span><span class="op">)</span></code></pre></div>
<p><img src="subMALDI_workflow_files/figure-html/unnamed-chunk-18-1.png" width="700"><img src="subMALDI_workflow_files/figure-html/unnamed-chunk-18-2.png" width="700"></p>
<p>The original spectra are shown to the right, while the normalized spectra are displayed on the left.</p>
<div id="maximum-intensity-of-set-normalization" class="section level3">
<h3 class="hasAnchor">
<a href="#maximum-intensity-of-set-normalization" class="anchor"></a>Maximum Intensity of Set Normalization</h3>
<p><strong><em>subMALDI</em></strong> also offers a maximum intensity normalization for a set of spectral replicates. In this method, the intensity of the most intense peak in the most intense spectrum in the data set is set as the maximum intensity. Again, the data is re-scaled to 0,1.</p>
<p>In this case, 1 represents the same value for all spectra in a data set, whereas in the previous method, 1 represents different intensity values in different spectra.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">maxset_ex</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/normSpectra.html">normSpectra</a></span><span class="op">(</span><span class="va">norm_spec</span>, mass_dat <span class="op">=</span> <span class="st">"full_mz"</span>, method <span class="op">=</span> <span class="st">"max_set"</span>, 
                         spectra_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Before1"</span>, <span class="st">"Before2"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="../reference/plotSpectra.html">plotSpectra</a></span><span class="op">(</span><span class="va">norm_spec</span>,mass_dat <span class="op">=</span> <span class="st">"full_mz"</span>, spectra_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Before1"</span>, <span class="st">"Before2"</span><span class="op">)</span>, x_ticks <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="fu"><a href="../reference/plotSpectra.html">plotSpectra</a></span><span class="op">(</span><span class="va">maxset_ex</span>, mass_dat <span class="op">=</span> <span class="st">"full_mz"</span>, spectra_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Before1"</span>, <span class="st">"Before2"</span><span class="op">)</span>, 
            x_ticks <span class="op">=</span> <span class="fl">5</span>, palette <span class="op">=</span> <span class="st">"Accent"</span><span class="op">)</span></code></pre></div>
<p><img src="subMALDI_workflow_files/figure-html/unnamed-chunk-19-1.png" width="700"><img src="subMALDI_workflow_files/figure-html/unnamed-chunk-19-2.png" width="700"></p>
<p>The original spectra are shown to the right, while the normalized spectra are displayed on the left.</p>
</div>
</div>
<div id="root-mean-squared-rms-normalization" class="section level2">
<h2 class="hasAnchor">
<a href="#root-mean-squared-rms-normalization" class="anchor"></a>Root Mean Squared (RMS) Normalization</h2>
<p>In this normalization method, the intensity of each peak in a spectrum is divided by the spectrum’s root mean squared error. The equation for RMS error is given below, where <em>n</em> represents the number of peaks in each spectrum and <em>I</em> represents the intensity of each individual peak in a spectrum.</p>
<p><span class="math inline">\(RMS = \sqrt{\frac{1}{n-1}*\sum{I^2}}\)</span></p>
<p>A sample RMS normalization is performed below.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">RMS_ex</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/normSpectra.html">normSpectra</a></span><span class="op">(</span><span class="va">norm_spec</span>, mass_dat <span class="op">=</span> <span class="st">"full_mz"</span>, method <span class="op">=</span> <span class="st">"RMS"</span>, spectra_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Before1"</span>, <span class="st">"Before2"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="../reference/plotSpectra.html">plotSpectra</a></span><span class="op">(</span><span class="va">norm_spec</span>,mass_dat <span class="op">=</span> <span class="st">"full_mz"</span>, spectra_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Before1"</span>, <span class="st">"Before2"</span><span class="op">)</span>, x_ticks <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="fu"><a href="../reference/plotSpectra.html">plotSpectra</a></span><span class="op">(</span><span class="va">RMS_ex</span>, mass_dat <span class="op">=</span> <span class="st">"full_mz"</span>, spectra_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Before1"</span>, <span class="st">"Before2"</span><span class="op">)</span>, 
            x_ticks <span class="op">=</span> <span class="fl">5</span>, palette <span class="op">=</span> <span class="st">"Accent"</span><span class="op">)</span></code></pre></div>
<p><img src="subMALDI_workflow_files/figure-html/unnamed-chunk-20-1.png" width="700"><img src="subMALDI_workflow_files/figure-html/unnamed-chunk-20-2.png" width="700"></p>
<p>The original spectra are shown to the right, while the normalized spectra are displayed on the left.</p>
</div>
<div id="total-ion-current-tic-normalization" class="section level2">
<h2 class="hasAnchor">
<a href="#total-ion-current-tic-normalization" class="anchor"></a>Total Ion Current (TIC) Normalization</h2>
<p>Total ion current (TIC) is one of the most common normalization techniques for MALDI-MS data<sup>1</sup>.</p>
<p>In this method, the total intensity of each spectrum in a data set is evaluated. If the total intensity of each spectrum in the data set is not already equal, the method multiplies each spectrum’s intensities by a normalization factor to equalize the TIC.</p>
<p>A sample normalization is performed below.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">TIC_ex</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/normSpectra.html">normSpectra</a></span><span class="op">(</span><span class="va">norm_spec</span>, mass_dat<span class="op">=</span> <span class="st">"full_mz"</span>, method <span class="op">=</span> <span class="st">"TIC"</span>, spectra_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Before1"</span>, <span class="st">"Before2"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="../reference/plotSpectra.html">plotSpectra</a></span><span class="op">(</span><span class="va">norm_spec</span>,mass_dat <span class="op">=</span> <span class="st">"full_mz"</span>, spectra_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Before1"</span>, <span class="st">"Before2"</span><span class="op">)</span>, x_ticks <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="fu"><a href="../reference/plotSpectra.html">plotSpectra</a></span><span class="op">(</span><span class="va">TIC_ex</span>, mass_dat <span class="op">=</span> <span class="st">"full_mz"</span>, spectra_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Before1"</span>, <span class="st">"Before2"</span><span class="op">)</span>,
            x_ticks <span class="op">=</span> <span class="fl">5</span>, palette <span class="op">=</span> <span class="st">"Accent"</span><span class="op">)</span></code></pre></div>
<p><img src="subMALDI_workflow_files/figure-html/unnamed-chunk-21-1.png" width="700"><img src="subMALDI_workflow_files/figure-html/unnamed-chunk-21-2.png" width="700"></p>
<p>The original spectra are shown to the right, while the normalized spectra are displayed on the left.</p>
<div id="relative-tic-normalization" class="section level3">
<h3 class="hasAnchor">
<a href="#relative-tic-normalization" class="anchor"></a>Relative TIC Normalization</h3>
<p><strong><em>subMALDI</em></strong> also includes a TIC normalization method which re-scales the intensity data to a relative intensity scale. This technique is identical to the method mentioned above, however, it divides each peak in a data set by the normalized TIC.</p>
<p>A sample normalization is performed below.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rel_TIC_ex</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/normSpectra.html">normSpectra</a></span><span class="op">(</span><span class="va">norm_spec</span>, mass_dat <span class="op">=</span> <span class="st">"full_mz"</span>, method <span class="op">=</span> <span class="st">"rel_TIC"</span>, spectra_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Before1"</span>, <span class="st">"Before2"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="../reference/plotSpectra.html">plotSpectra</a></span><span class="op">(</span><span class="va">norm_spec</span>, mass_dat <span class="op">=</span> <span class="st">"full_mz"</span>, spectra_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Before1"</span>, <span class="st">"Before2"</span><span class="op">)</span>, x_ticks <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="fu"><a href="../reference/plotSpectra.html">plotSpectra</a></span><span class="op">(</span><span class="va">rel_TIC_ex</span>, mass_dat <span class="op">=</span> <span class="st">"full_mz"</span>, spectra_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Before1"</span>, <span class="st">"Before2"</span><span class="op">)</span>,
            x_ticks <span class="op">=</span> <span class="fl">5</span>, palette <span class="op">=</span> <span class="st">"Accent"</span><span class="op">)</span></code></pre></div>
<p><img src="subMALDI_workflow_files/figure-html/unnamed-chunk-22-1.png" width="700"><img src="subMALDI_workflow_files/figure-html/unnamed-chunk-22-2.png" width="700"></p>
<p>The original spectra are shown to the right, while the normalized spectra are displayed on the left.</p>
<p>The TIC of each spectrum in the output of the relative TIC normalization are equal to one. The TIC of the data set should be equal to the number of spectra in the set. An example is shown below.</p>
<p>In our output, we have two spectra.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">rel_TIC_ex</span><span class="op">)</span>
<span class="co">#&gt;   full_mz      Before1      Before2</span>
<span class="co">#&gt; 1   53.76 9.438443e-06 5.710200e-06</span>
<span class="co">#&gt; 2   53.77 8.707913e-06 1.346139e-05</span>
<span class="co">#&gt; 3   53.78 1.243214e-05 2.253410e-05</span>
<span class="co">#&gt; 4   53.79 9.518488e-06 2.559780e-05</span>
<span class="co">#&gt; 5   53.80 6.256404e-06 2.736819e-05</span>
<span class="co">#&gt; 6   53.81 5.920787e-06 2.138599e-05</span></code></pre></div>
<p>The sum of each spectrum’s respective intensities is evaluated below, in addition to the total sum of intensities in the output data set. We can see that both individual spectra have normalized TICs of 1, and that the total intensity of the spectrum is 2, the number of spectra in the set.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">rel_TIC_ex</span><span class="op">$</span><span class="va">Before1</span><span class="op">)</span>
<span class="co">#&gt; [1] 1</span>
<span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">rel_TIC_ex</span><span class="op">$</span><span class="va">Before2</span><span class="op">)</span>
<span class="co">#&gt; [1] 1</span>
<span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">rel_TIC_ex</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; [1] 2</span></code></pre></div>
</div>
</div>
<div id="median-normalization" class="section level2">
<h2 class="hasAnchor">
<a href="#median-normalization" class="anchor"></a>Median Normalization</h2>
<p>Median normalization is similar to the TIC normalization method<sup>1</sup>. In both techniques, a simple operation is performed on the intensity data of each spectrum in a data set. If the result of the operation is not equal between all spectra, then the intensities are multiplied by a correction factor to make them so<sup>1</sup>.</p>
<p>Unlike TIC normalization, which evaluates the sum of all intensities in a spectrum, median normalization evaluates the median of each spectrum.</p>
<p>First, the intensity data from each spectrum is sorted from most to least intense. Next, the data set is truncated so that all spectra contain the same number of data points<sup>1</sup>. The number of peaks removed is dependent on the variation in size between each spectrum in the data set. The spectrum containing the least amount of non-zero peaks acts as the guide for truncation.</p>
<p>Once the spectra have been corrected to contain the same number of data points, the median intensity value in the sorted data set is evaluated. If the median is not consistent between spectral replicates, then the intensity data of each spectrum is multiplied by a normalization factor.</p>
<p>A sample median normalization is performed below.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">median_ex</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/normSpectra.html">normSpectra</a></span><span class="op">(</span><span class="va">norm_spec</span>, mass_dat <span class="op">=</span> <span class="st">"full_mz"</span>, method <span class="op">=</span> <span class="st">"median"</span>, spectra_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Before1"</span>, <span class="st">"Before2"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="../reference/plotSpectra.html">plotSpectra</a></span><span class="op">(</span><span class="va">norm_spec</span>,mass_dat <span class="op">=</span> <span class="st">"full_mz"</span>, spectra_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Before1"</span>, <span class="st">"Before2"</span><span class="op">)</span>, x_ticks <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="fu"><a href="../reference/plotSpectra.html">plotSpectra</a></span><span class="op">(</span><span class="va">median_ex</span>, mass_dat <span class="op">=</span> <span class="st">"full_mz"</span>, spectra_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Before1"</span>, <span class="st">"Before2"</span><span class="op">)</span>, 
            x_ticks <span class="op">=</span> <span class="fl">5</span>, palette <span class="op">=</span> <span class="st">"Accent"</span><span class="op">)</span></code></pre></div>
<p><img src="subMALDI_workflow_files/figure-html/unnamed-chunk-25-1.png" width="700"><img src="subMALDI_workflow_files/figure-html/unnamed-chunk-25-2.png" width="700"></p>
<p>The original spectra are shown to the right, while the normalized spectra are displayed on the left.</p>
</div>
<div id="standard-deviation-of-noise-normalization" class="section level2">
<h2 class="hasAnchor">
<a href="#standard-deviation-of-noise-normalization" class="anchor"></a>Standard Deviation of Noise Normalization</h2>
<p>Standard deviation of noise normalization is focused on normalizing noisy regions of each spectrum. The idea is that the standard deviation of noisy regions should be equal in all spectra<sup>1</sup>.</p>
<p>In order to use this method, a large region of the spectra must be identified wherein there is <em>only</em> noise and no peaks. This region must be the same between all spectral replicates to be normalized.</p>
<p>A plot of our raw data is shown below. Here we can see that there is a noisy region from <em>m/z</em> 900 to 1000. We will use this region for our sample normalization.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plotSpectra.html">plotSpectra</a></span><span class="op">(</span><span class="va">norm_spec</span>, mass_dat <span class="op">=</span> <span class="st">"full_mz"</span>, spectra_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Before1"</span>, <span class="st">"Before2"</span><span class="op">)</span>, 
            x_ticks <span class="op">=</span> <span class="fl">5</span>, min_mz <span class="op">=</span> <span class="fl">750</span>, max_mz <span class="op">=</span> <span class="fl">1100</span><span class="op">)</span></code></pre></div>
<p><img src="subMALDI_workflow_files/figure-html/unnamed-chunk-26-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Once a spectral region of noise has been identified, the standard deviation of the intensities in this region is evaluated. The intensity of each peak in a spectrum is then divided by that spectrum’s standard deviation of noise. The output spectra should have a standard deviation of 1 in the selected noise region<sup>1</sup>.</p>
<p>A sample standard deviation of noise normalization is performed below, using a lower <em>m/z</em> bound of 900 and an upper bound of <em>m/z</em> 1000.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">stdev_ex</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/normSpectra.html">normSpectra</a></span><span class="op">(</span><span class="va">norm_spec</span>, mass_dat <span class="op">=</span> <span class="st">"full_mz"</span>, method <span class="op">=</span> <span class="st">"stdev"</span>, 
                        lower <span class="op">=</span> <span class="fl">900</span>, upper <span class="op">=</span> <span class="fl">1000</span>, spectra_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Before1"</span>, <span class="st">"Before2"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="../reference/plotSpectra.html">plotSpectra</a></span><span class="op">(</span><span class="va">norm_spec</span>,mass_dat <span class="op">=</span> <span class="st">"full_mz"</span>, spectra_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Before1"</span>, <span class="st">"Before2"</span><span class="op">)</span>, x_ticks <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="fu"><a href="../reference/plotSpectra.html">plotSpectra</a></span><span class="op">(</span><span class="va">stdev_ex</span>, mass_dat <span class="op">=</span> <span class="st">"full_mz"</span>, spectra_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Before1"</span>, <span class="st">"Before2"</span><span class="op">)</span>, x_ticks <span class="op">=</span> <span class="fl">5</span>, palette <span class="op">=</span> <span class="st">"Accent"</span><span class="op">)</span></code></pre></div>
<p><img src="subMALDI_workflow_files/figure-html/unnamed-chunk-27-1.png" width="700"><img src="subMALDI_workflow_files/figure-html/unnamed-chunk-27-2.png" width="700"></p>
<p>The original spectra are shown to the right, while the normalized spectra are displayed on the left.</p>
</div>
<div id="quantile-normalization" class="section level2">
<h2 class="hasAnchor">
<a href="#quantile-normalization" class="anchor"></a>Quantile Normalization</h2>
<p>Quantile normalization is the final method included in the package. The method was originally developed for multiple high-density arrays<sup>1</sup>.</p>
<p>Quantile normalization consists of two steps<sup>2</sup>:</p>
<ol style="list-style-type: decimal">
<li>An index is created for all intensity values in a spectrum to document their original order. The data is then sorted by decreasing intensity. For each rank, the average of the intensities (one per spectrum) is saved.</li>
<li>The actual intensity values in each spectrum are replaced with these averages. The data is then resorted by the index.</li>
</ol>
<p>This makes the distributions of the values equal in all spectra<sup>1</sup>. The quantile normalization technique is demonstrated below.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">quantile_ex</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/normSpectra.html">normSpectra</a></span><span class="op">(</span><span class="va">norm_spec</span>, mass_dat <span class="op">=</span> <span class="st">"full_mz"</span>, method <span class="op">=</span> <span class="st">"quantile"</span>, spectra_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Before1"</span>, <span class="st">"Before2"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="../reference/plotSpectra.html">plotSpectra</a></span><span class="op">(</span><span class="va">norm_spec</span>,mass_dat <span class="op">=</span> <span class="st">"full_mz"</span>, spectra_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Before1"</span>, <span class="st">"Before2"</span><span class="op">)</span>, x_ticks <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="fu"><a href="../reference/plotSpectra.html">plotSpectra</a></span><span class="op">(</span><span class="va">quantile_ex</span>, mass_dat <span class="op">=</span> <span class="st">"full_mz"</span>, spectra_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Before1"</span>, <span class="st">"Before2"</span><span class="op">)</span>, x_ticks <span class="op">=</span> <span class="fl">5</span>, palette <span class="op">=</span> <span class="st">"Accent"</span><span class="op">)</span></code></pre></div>
<p><img src="subMALDI_workflow_files/figure-html/unnamed-chunk-28-1.png" width="700"><img src="subMALDI_workflow_files/figure-html/unnamed-chunk-28-2.png" width="700"></p>
<p>The original spectra are shown to the right, while the normalized spectra are displayed on the left.</p>
<hr>
</div>
</div>
<div id="plotting-spectra" class="section level1">
<h1 class="hasAnchor">
<a href="#plotting-spectra" class="anchor"></a>Plotting Spectra</h1>
<p>Several sample plots were shown above to illustrate the different normalization methods. In this section we will show the features of the  function, and demonstrate its capabilities.</p>
<p>We can plot data from the original pairwise data frame, or from a mapped spectral data frame. An example of the former is shown below.</p>
<p>In this example, we use the arguments <code>lbls = TRUE</code> and <code>span = 9</code>. This labels the peak maxima in the spectrum. The span argument determines how many maxima will be labeled. In this case, we’ve selected a value of 9. This means that four peaks on either side of each labeled peak are not labelled.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"Blank1"</span><span class="op">)</span>
<span class="fu"><a href="../reference/plotSpectra.html">plotSpectra</a></span><span class="op">(</span>dat <span class="op">=</span> <span class="va">Blank1</span>, mass_dat <span class="op">=</span> <span class="st">"mass"</span>, spectra_cols <span class="op">=</span> <span class="st">"Intensity"</span>, 
             lbls <span class="op">=</span> <span class="cn">TRUE</span>, span <span class="op">=</span> <span class="fl">9</span>, x_ticks <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></code></pre></div>
<p><img src="subMALDI_workflow_files/figure-html/unnamed-chunk-29-1.png" width="576" style="display: block; margin: auto;"></p>
<p>We can also customize the color and the <em>m/z</em> range of the plot. In this example we will plot a single spectrum from a mapped spectral data frame without labels. We will change the color of the spectrum to <code>"black"</code> and zoom in on the <em>m/z</em> region from <em>m/z</em> 100 to 500.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"Master"</span><span class="op">)</span>
<span class="fu"><a href="../reference/plotSpectra.html">plotSpectra</a></span><span class="op">(</span>dat <span class="op">=</span> <span class="va">Master</span>, mass_dat <span class="op">=</span> <span class="st">"full_mz"</span>, spectra_cols <span class="op">=</span> <span class="st">"After2"</span>, 
             colours <span class="op">=</span> <span class="st">"black"</span>, min_mz <span class="op">=</span> <span class="fl">100</span>, max_mz <span class="op">=</span> <span class="fl">500</span>, x_ticks <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></code></pre></div>
<p><img src="subMALDI_workflow_files/figure-html/unnamed-chunk-30-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Not all spectral data has the same resolution. As such, the labels on each mass spectrum should accurately reflect the resolution of the raw data.</p>
<p>By default, <strong><em>subMALDI</em></strong> displays all labels in the format XXX.XXXX, as this is the resolution of most of the data included with the package. In this example, we will customize the resolution of our <em>m/z</em> labels to match a lower resolution data set.</p>
<p>Here we load the low resolution spectral data set.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"Master2"</span><span class="op">)</span></code></pre></div>
<p>We will customize our label output using the argument . The default value for this argument is “%3.4f”. This means our output will have three digits on the left of the decimal point and four to the right.</p>
<p>Our low resolution data only has two decimal places, therefore our  argument will be “%3.2f”.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plotSpectra.html">plotSpectra</a></span><span class="op">(</span>dat <span class="op">=</span> <span class="va">Master2</span>, mass_dat <span class="op">=</span> <span class="st">"full_mz"</span>, spectra_cols <span class="op">=</span> <span class="st">"Before1"</span>, lbls <span class="op">=</span> <span class="cn">TRUE</span>, lbl.fmt <span class="op">=</span> <span class="st">"%3.2f"</span>, x_ticks <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></code></pre></div>
<p><img src="subMALDI_workflow_files/figure-html/unnamed-chunk-32-1.png" width="576" style="display: block; margin: auto;"></p>
<div id="plotting-multiple-spectra" class="section level2">
<h2 class="hasAnchor">
<a href="#plotting-multiple-spectra" class="anchor"></a>Plotting Multiple Spectra</h2>
<p>When plotting multiple spectra on the same <em>m/z</em> axis, the <code>nrows</code> argument should be used. Here, we set <code>nrows = 1</code> such that the four plots are stacked on top of one another, and sharing the same <em>m/z</em> axis.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plotSpectra.html">plotSpectra</a></span><span class="op">(</span>dat <span class="op">=</span> <span class="va">Master</span>, mass_dat <span class="op">=</span> <span class="st">"full_mz"</span>, spectra_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Before1"</span>, <span class="st">"Before2"</span>, <span class="st">"After1"</span>, <span class="st">"After2"</span><span class="op">)</span>, 
            lbls <span class="op">=</span> <span class="cn">TRUE</span>, span <span class="op">=</span> <span class="fl">15</span>, nrows <span class="op">=</span> <span class="fl">4</span>, x_ticks <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></code></pre></div>
<p><img src="subMALDI_workflow_files/figure-html/unnamed-chunk-33-1.png" width="576" style="display: block; margin: auto;"></p>
<p>If a grid format is preferred, the <code>nrows</code> argument can be adjusted and will produce the best-fitting layout.</p>
<hr>
</div>
</div>
<div id="references" class="section level1">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<ol style="list-style-type: decimal">
<li>O. Haglund, Qualitative comparison of normalization approaches in MALDI-MS, M.Sc Thesis, Royal Institute of Technology, Stockholm, Sweden, 2008.</li>
<li>K. V. Ballman, D. E. Grill, A. L. Oberg, T. M. Therneau, Faster Cyclic Loess: normalizing RNA analysis via linear models, <em>Bioinformatics</em>, 2004, <strong>20</strong>, 2778-2786.</li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Wesley Burr.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link external-link">pkgdown</a> 1.6.1.9000.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
